<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0087)https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cross_compiles.md -->
<html class="doc-page"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>How GN handles cross-compiling</title><link rel="stylesheet" type="text/css" href="./How GN handles cross-compiling_files/doc.0L3SNFV84koi7_B276HAQw.cache.css"><link rel="stylesheet" type="text/css" href="./How GN handles cross-compiling_files/prettify.pZ5FqzM6cPxAflH0va2Ucw.cache.css"></head><body><div class="doc"><h1><a class="h" name="How-GN-handles-cross_compiling" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cross_compiles.md#How-GN-handles-cross_compiling"><span></span></a>How GN handles cross-compiling</h1><h2><a class="h" name="As-a-GN-user" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cross_compiles.md#As-a-GN-user"><span></span></a>As a GN user</h2><p>GN has robust support for doing cross compiles and building things for multiple architectures in a single build (e.g., to build some things to run locally and some things to run on an embedded device). In fact, there is no limit on the number of different architectures you can build at once; the Chromium build uses at least four in some configurations.</p><p>To start, GN has the concepts of a <em>host</em> and a <em>target</em>. The host is the platform that the build is run on, and the target is the platform where the code will actually run (This is different from <a href="http://www.gnu.org/software/automake/manual/html_node/Cross_002dCompilation.html">autotools</a>’ terminology, but uses the more common terminology for cross compiling**).**</p><p>(Confusingly, GN also refers to each build artifact – an executable, library, etc. – as a target. On this page, we will use “target” only to refer to the system you want to run your code on, and use “rule” or some other synonym to refer to a specific build artifact).</p><p>When GN starts up, the <code>host_os</code> and <code>host_cpu</code> variables are set automatically to match the operating system (they can be overridden in args files, which can be useful in weird corner cases). The user can specify that they want to do a cross-compile by setting either or both of <code>target_os</code> and <code>target_cpu</code>; if they are not set, the build config files will usually set them to the host’s values, though the Chromium build will set target_cpu to “arm” if target_os is set to “android”).</p><p>So, for example, running on an x64 Linux machine:</p><pre class="code">gn gen out/Default
</pre><p>is equivalent to:</p><pre class="code">gn gen out/Default --args='target_os="linux" target_cpu="x64"'
</pre><p>To do an 32-bit ARM Android cross-compile, do:</p><pre class="code">gn gen out/Default --args='target_os="android"'
</pre><p>(We don’t have to specify target_cpu because of the conditionals mentioned above).</p><p>And, to do a 64-bit MIPS ChromeOS cross-compile:</p><pre class="code">gn gen out/Default --args='target_os="chromeos" target_cpu="mips64el"'
</pre><h2><a class="h" name="As-a-BUILD_gn-author" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cross_compiles.md#As-a-BUILD_gn-author"><span></span></a>As a BUILD.gn author</h2><p>If you are editing build files outside of the //build directory (i.e., not directly working on toolchains, compiler configs, etc.), generally you only need to worry about a few things:</p><p>The <code>current_toolchain</code>, <code>current_cpu</code>, and <code>current_os</code> variables reflect the settings that are <strong>currently</strong> in effect in a given rule. The <code>is_linux</code>, <code>is_win</code> etc. variables are updated to reflect the current settings, and changes to <code>cflags</code>, <code>ldflags</code> and so forth also only apply to the current toolchain and the current thing being built.</p><p>You can also refer to the <code>target_cpu</code> and <code>target_os</code> variables. This is useful if you need to do something different on the host depending on which target_arch is requested; the values are constant across all toolchains. You can do similar things for the <code>host_cpu</code> and <code>host_os</code> variables, but should generally never need to.</p><p>By default, dependencies listed in the <code>deps</code> variable of a rule use the same (currently active) toolchain. You may specify a different toolchain using the <code>foo(bar)</code> label notation as described in <a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/GNLanguage#Labels.md">GNLanguage#Labels</a>.</p><h2><a class="h" name="As-a-build_config-or-build_toolchain-author" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cross_compiles.md#As-a-build_config-or-build_toolchain-author"><span></span></a>As a //build/config or //build/toolchain author</h2><p>As described in <a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/GNLanguage#Overall_build_flow.md">GNLanguage#Overall_build_flow</a>, the <code>default_toolchain</code> is declared in the //build/config/BUILDCONFIG.gn file. Usually the default_toolchain should be the toolchain for the target_os and target_cpu. The <code>current_toolchain</code> reflects the toolchain that is currently in effect for a rule.</p><p>Be sure you understand the differences between <code>host_cpu</code>, <code>target_cpu</code>, <code>current_cpu</code>, and <code>toolchain_cpu</code> (and the os equivalents). The first two are set as described above. You are responsible for making sure that <code>current_cpu</code> is set appropriately in your toolchain definitions; if you are using the stock templates like <code>gcc_toolchain</code> and <code>msvc_toolchain</code>, that means you are responsible for making sure that <code>toolchain_cpu</code> and <code>toolchain_os</code> are set as appropriate in the template invocations.</p></div><div class="footer-break"></div><div class="footer-line"><div class="nav-aux"><ul><li><a href="https://chromium.googlesource.com/chromium/src/+show/master/tools/gn/docs/cross_compiles.md">source</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+log/master/tools/gn/docs/cross_compiles.md">log</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+blame/master/tools/gn/docs/cross_compiles.md">blame</a></li></ul><div class="gitiles-att">Powered by <a href="https://code.google.com/p/gitiles/">Gitiles</a></div></div></div><script async="" src="./How GN handles cross-compiling_files/analytics.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-55762617-15', 'auto'); ga('send', 'pageview', {title: 'How GN handles cross-compiling'});</script></body></html>