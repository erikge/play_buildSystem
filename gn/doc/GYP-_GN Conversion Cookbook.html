<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0081)https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md -->
<html class="doc-page"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>GYP-&gt;GN Conversion Cookbook</title><link rel="stylesheet" type="text/css" href="./GYP-_GN Conversion Cookbook_files/doc.0L3SNFV84koi7_B276HAQw.cache.css"><link rel="stylesheet" type="text/css" href="./GYP-_GN Conversion Cookbook_files/prettify.pZ5FqzM6cPxAflH0va2Ucw.cache.css"></head><body><div class="doc"><h1><a class="h" name="GYP_GN-Conversion-Cookbook" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#GYP_GN-Conversion-Cookbook"><span></span></a>GYP-&gt;GN Conversion Cookbook</h1><div class="toc" role="navigation"><h2>Contents</h2><div class="toc-aux"><ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Targets">Targets</a></li><ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Note-on-static-libraries">Note on static libraries</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Actions">Actions</a></li></ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Platform-checking">Platform checking</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Typical-sources-and-deps-modifications">Typical sources and deps modifications</a></li><ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#GYP">GYP</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#GN">GN</a></li></ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Variable-mappings">Variable mappings</a></li><ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Build-configuration">Build configuration</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Feature-flags">Feature flags</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Common-target-conversion">Common target conversion</a></li></ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Visibility-and-header-file-issues">Visibility and header file issues</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Other-stuff">Other stuff</a></li><ul><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Target-conditions">Target conditions</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#xcode_settings">xcode_settings</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#wexit_time-destructors">wexit-time destructors</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Chromium-code">Chromium code</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#fvisibility">-fvisibility</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Dependent-settings">Dependent settings</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#MSVS-disabled-warnings">MSVS disabled warnings</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Mac-frameworks">Mac frameworks</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#hard_dependency">hard_dependency</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Allocator">Allocator</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#optimize_max">optimize: max</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Protobufs">Protobufs</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Java-stuff">Java stuff</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Grit">Grit</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Mojo">Mojo</a></li></ul></ul></div></div><h2><a class="h" name="Targets" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Targets"><span></span></a>Targets</h2><table><thead><tr><th align="left"><em>GYP</em> </th><th align="left"><em>GN</em> </th></tr></thead><tbody><tr><td align="left"><code>'type': 'static_library', 'name': 'foo',</code> </td><td align="left"><code>static_library("foo") {</code> or <code>source_set("foo") {</code> </td></tr><tr><td align="left"><code>'type': 'shared_library', 'name': 'foo',</code> </td><td align="left"><code>shared_library("foo") {</code> </td></tr><tr><td align="left"><code>'type': '&lt;(component)', 'name': 'foo',</code> </td><td align="left"><code>component("foo") {</code> </td></tr><tr><td align="left"><code>'type': 'executable', 'name': 'foo',</code> </td><td align="left"><code>executable("foo") {</code> </td></tr><tr><td align="left"><code>'type': '&lt;(gtest_target_type)', 'name': 'foo',</code> </td><td align="left"><code>test("foo") {</code> </td></tr><tr><td align="left"><code>'type': 'none', 'name': 'foo',</code> </td><td align="left"><code>group("foo") {</code> </td></tr></tbody></table><h3><a class="h" name="Note-on-static-libraries" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Note-on-static-libraries"><span></span></a>Note on static libraries</h3><p>A source_set is basically a transparent static_library. The source files are compiled with the given options but not linked into anything. Targets that depend on a source set get the source set’s object files linked into it. This saves the overhead of creating a static library on disk, avoids weird linker issues when a static library has no source files, and you can link source sets into shared libraries and have symbols exported from the shared library.</p><p>The last issue is a cause of a lot of headaches in the GYP build. If you annotate a symbol as exported (i.e. <code>BASE_EXPORT</code>) then you can’t have it in a file that goes into a static library because the function might be <a href="http://blogs.msdn.com/b/oldnewthing/archive/2014/03/21/10509670.aspx">stripped out</a> if it’s not called from within the static library. This prevents composing components of static libraries and exporting their symbols. A source set avoids this issue and <code>EXPORT</code> has the desired meaning of “export from the component this gets linked into” with no surprising dead code stripping behavior.</p><p>A disadvantage of source sets is that if an object file is completely unused, it will still be linked into the result, which is not the case for static libraries. A few places in the build depend on this behavior (deliberately or accidentally). In general, small libraries that we expect to be entirely used, test helpers, etc. can be source sets. There is slightly less risk of subtle issues if you keep static libraries static libraries, however.</p><h3><a class="h" name="Actions" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Actions"><span></span></a>Actions</h3><p>GYP</p><pre class="code">{
  'action_name': 'foo',
  'inputs': [ 'bar.py' ],
  'outputs': [ '&lt;(SHARED_INTERMEDIATE_DIR)/bar.out' ],
  'action': ['python', 'bar.py', '--la_dee_da' ],
},
</pre><p>Unlike GYP, where an action is a part of a target, GN actions are separate targets that you then depend on via deps from other targets:</p><pre class="code">action("foo") {
  script = "bar.py"
  outputs = [ "$target_gen_dir/bar.out" ]
  args = [ "--la_dee_da" ]
}

executable('foo.exe') {
  ...
  deps = [ ":foo" ]  # Depend on the action to make sure it runs.
}
</pre><p>Rules in GYP become <code>action_foreach</code> in GN which work like actions but iterate over a set of sources.</p><h2><a class="h" name="Platform-checking" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Platform-checking"><span></span></a>Platform checking</h2><table><thead><tr><th align="left"><em>GYP</em> </th><th align="left"><em>GN</em> </th></tr></thead><tbody><tr><td align="left"><code>'conditions': [['OS=="win"', {</code> </td><td align="left"><code>if (is_win) {</code> </td></tr><tr><td align="left"><code>'conditions': [['OS=="linux"', {</code> </td><td align="left"><code>if (is_linux) {</code> </td></tr><tr><td align="left"><code>'conditions': [['OS=="android"', {</code> </td><td align="left"><code>if (is_android) {</code> </td></tr><tr><td align="left"><code>'conditions': [['OS=="mac"', {</code> </td><td align="left"><code>if (is_mac) {</code> </td></tr><tr><td align="left"><code>'conditions': [['OS=="ios"', {</code> </td><td align="left"><code>if (is_ios) {</code> </td></tr><tr><td align="left"><code>'conditions': [['chromeos==1', {</code> </td><td align="left"><code>if (is_chromeos) {</code> </td></tr></tbody></table><h2><a class="h" name="Typical-sources-and-deps-modifications" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Typical-sources-and-deps-modifications"><span></span></a>Typical sources and deps modifications</h2><h3><a class="h" name="GYP" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#GYP"><span></span></a>GYP</h3><pre class="code">'sources': [
  'a.cc',
  'b.cc',
],
'dependencies': [
  '&lt;(DEPTH)/base/base.gyp:foo',
],
'conditions': [
  ['OS=="win"': {
    'sources!': [
       'a.cc',
    ],
    'sources': [
      'foo.cc',
    ],
    'dependencies': [
      '&lt;(DEPTH)/base/base.gyp:bar',
    ],
  }, {
    'sources/': [
      ['exclude', '^b\\.cc$'],
    ],
  }],
],
</pre><h3><a class="h" name="GN" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#GN"><span></span></a>GN</h3><pre class="code">sources = [
  "a.cc",
  "b.cc",
]
deps = [
  "//base:foo",
]

if (is_win) {
  sources -= [ "a.cc" ]
  sources += [ "foo.cc" ]
  deps += [ "//base:bar" ]
} else {
  sources -= [ "b.cc" ]
}
</pre><h2><a class="h" name="Variable-mappings" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Variable-mappings"><span></span></a>Variable mappings</h2><h3><a class="h" name="Build-configuration" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Build-configuration"><span></span></a>Build configuration</h3><p>Build configuration and feature flags are usually global in GYP. In GN we try to limit global variables and instead put variables used by only some files into <code>.gni</code> files. These files are then imported into your buildfile by specifying at the top:</p><pre class="code">import("//build/config/features.gni")

# ... now you can use the variables declared in features.gni.
if (is_tsan) {
  # ...
}
if (cld_version == 2) {
  # ...
}
</pre><p>Other flags only apply to one <code>BUILD.gn</code> file and those flags are declared directly in that file (so other files can’t use them). These places are noted in the table below.</p><table><thead><tr><th align="left"><em>GYP</em> </th><th align="left"><em>GN</em> </th><th align="left"><em>GN import</em> </th></tr></thead><tbody><tr><td align="left"><code>arm_float_abi</code> </td><td align="left"><code>arm_float_abi</code> </td><td align="left"><code>//build/config/arm.gni</code> </td></tr><tr><td align="left"><code>arm_neon</code> (0/1) </td><td align="left"><code>arm_use_neon</code> (true/false) </td><td align="left"><code>//build/config/arm.gni</code> </td></tr><tr><td align="left"><code>arm_neon_optional</code> (0/1) </td><td align="left"><code>arm_optionally_use_neon</code> (true/false) </td><td align="left"><code>//build/config/arm.gni</code> </td></tr><tr><td align="left"><code>arm_version</code> </td><td align="left"><code>arm_version</code> </td><td align="left"><code>//build/config/arm.gni</code> </td></tr><tr><td align="left"><code>asan</code> (0/1) </td><td align="left"><code>is_asan</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>branding</code> (“Chromium”/“Chrome”) </td><td align="left"><code>is_chrome_branded</code> (true/false) </td><td align="left"><code>//build/config/chrome_build.gni</code> </td></tr><tr><td align="left"><code>build_for_tool=="drmemory"</code> </td><td align="left"><code>enable_iterator_debugging=false</code> </td><td align="left">(internal to <code>//build/config/BUILD.gn</code>) </td></tr><tr><td align="left"><code>build_for_tool=="tsan"</code> </td><td align="left"><code>enable_iterator_debugging=false</code> </td><td align="left">(internal to <code>//build/config/BUILD.gn</code>) </td></tr><tr><td align="left"><code>buildtype</code> (“Official”/“Dev”) </td><td align="left"><code>is_official_build</code> (true/false) </td><td align="left"><code>//build/config/chrome_build.gni</code> </td></tr><tr><td align="left"><code>chrome_multiple_dll</code> (0/1) </td><td align="left"><code>is_multi_dll_chrome</code> (true/false) </td><td align="left"><code>//build/config/chrome_build.gni</code> </td></tr><tr><td align="left"><code>clang</code> (0/1) </td><td align="left"><code>is_clang</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>clang_use_chrome_plugins</code> (0/1) </td><td align="left"><code>clang_use_chrome_plugins</code> (true/false) </td><td align="left">(internal to <code>//build/config/clang/BUILD.gn</code>) </td></tr><tr><td align="left"><code>component</code> (“shared_library”/“static_library”) </td><td align="left"><code>is_component_build</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>desktop_linux</code> (0/1) </td><td align="left"><code>is_desktop_linux</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>disable_glibcxx_debug</code> (0/1) </td><td align="left"><code>enable_iterator_debugging</code> (true/false) </td><td align="left">(internal to <code>//build/config/BUILD.gn</code>) </td></tr><tr><td align="left"><code>fastbuild</code> (0/1/2) </td><td align="left"><code>symbol_level</code> (2/1/0 — values inverted) </td><td align="left">(global) </td></tr><tr><td align="left"><code>gomadir</code> </td><td align="left"><code>goma_dir</code> </td><td align="left"><code>//build/toolchain/goma.gni</code> </td></tr><tr><td align="left"><code>ios_deployment_target</code> (string) </td><td align="left"><code>ios_deployment_target</code> </td><td align="left"><code>//build/config/ios/ios_sdk.gni</code> </td></tr><tr><td align="left"><code>GYP_MSVS_OVERRIDE_PATH</code> environment variable </td><td align="left"><code>visual_studio_path</code> </td><td align="left"><code>//build/config/win/visual_studio_version.gni</code> </td></tr><tr><td align="left"><code>GYP_MSVS_VERSION</code> environment variable </td><td align="left">(none) </td><td align="left"> </td></tr><tr><td align="left"><code>ios_sdk_path</code> </td><td align="left"><code>ios_sdk_path</code> and <code>use_ios_simulator</code> </td><td align="left"><code>//build/config/ios/ios_sdk.gni</code> </td></tr><tr><td align="left"><code>lsan</code> (0/1) </td><td align="left"><code>is_lsan</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>mac_sdk_min</code> </td><td align="left"><code>mac_sdk_min</code> </td><td align="left"><code>//build/config/mac/mac_sdk.gni</code> </td></tr><tr><td align="left"><code>mac_sdk_path</code> </td><td align="left"><code>mac_sdk_path</code> </td><td align="left"><code>//build/config/mac/mac_sdk.gni</code> </td></tr><tr><td align="left"><code>mac_sdk</code> </td><td align="left"><code>mac_sdk_version</code> </td><td align="left"><code>//build/config/mac/mac_sdk.gni</code> </td></tr><tr><td align="left"><code>msan</code> (0/1) </td><td align="left"><code>is_msan</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>SDKROOT</code> (Mac) </td><td align="left"><code>sysroot</code> </td><td align="left"><code>//build/config/sysroot.gni</code> </td></tr><tr><td align="left"><code>sysroot</code> </td><td align="left"><code>sysroot</code> </td><td align="left"><code>//build/config/sysroot.gni</code> </td></tr><tr><td align="left"><code>target_arch</code> (“ia32”/“x64”/“arm”/“mipsel”) </td><td align="left"><code>target_arch</code> (“x86”/“x64”/“arm”/“mipsel”) </td><td align="left">(global) </td></tr><tr><td align="left"><code>toolkit_views</code> (0/1) </td><td align="left"><code>toolkit_views</code> </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>tsan</code> (0/1) </td><td align="left"><code>is_tsan</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>windows_sdk_path</code> </td><td align="left"><code>windows_sdk_path</code> </td><td align="left">(internal to <code>//build/config/win/BUILD.gn</code>) </td></tr></tbody></table><h3><a class="h" name="Feature-flags" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Feature-flags"><span></span></a>Feature flags</h3><table><thead><tr><th align="left"><em>GYP</em> </th><th align="left"><em>GN</em> </th><th align="left"><em>GN import</em> </th></tr></thead><tbody><tr><td align="left"><code>cld_version</code> (number) </td><td align="left"><code>cld_version</code> (number) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>configuration_policy</code> (0/1) </td><td align="left"><code>enable_configuration_policy</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>debug_devtools</code> (0/1) </td><td align="left"><code>debug_devtools</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>disable_ftp_support</code> (0/1) </td><td align="left"><code>disable_ftp_support</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>disable_nacl</code> (0/1) </td><td align="left"><code>enable_nacl</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_app_list</code> (0/1) </td><td align="left"><code>enable_app_list</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_autofill_dialog</code> (0/1) </td><td align="left"><code>enable_autofill_dialog</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_background</code> (0/1) </td><td align="left"><code>enable_background</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_captive_portal_detection</code> (0/1) </td><td align="left"><code>enable_captive_portal_detection</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_chromevox_next</code> (0/1) </td><td align="left"><code>enable_chromevox_next</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_extensions</code> (0/1) </td><td align="left"><code>enable_extensions</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_google_now</code> (0/1) </td><td align="left"><code>enable_google_now</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_hidpi</code> (0/1) </td><td align="left"><code>enable_hidpi</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>enable_managed_users</code> (0/1) </td><td align="left"><code>enable_managed_users</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_mdns</code> (0/1) </td><td align="left"><code>enable_mdns</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_one_click_signin</code> (0/1) </td><td align="left"><code>enable_one_click_signin</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_pepper_cdms</code> (0/1) </td><td align="left"><code>enable_pepper_cdms</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_plugins</code> (0/1) </td><td align="left"><code>enable_plugins</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_plugin_installation</code> (0/1) </td><td align="left"><code>enable_plugin_installation</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_basic_printing</code> (0/1) </td><td align="left"><code>enable_basic_printing</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_print_preview</code> (0/1) </td><td align="left"><code>enable_print_preview</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_rlz</code> (0/1) </td><td align="left"><code>enable_rlz</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_service_discovery</code> (0/1) </td><td align="left"><code>enable_service_discovery</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_spellcheck</code> (0/1) </td><td align="left"><code>enable_spellcheck</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_session_service</code> (0/1) </td><td align="left"><code>enable_session_service</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_settings_app</code> (0/1) </td><td align="left"><code>enable_settings_app</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_task_manager</code> (0/1) </td><td align="left"><code>enable_task_manager</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_themes</code> (0/1) </td><td align="left"><code>enable_themes</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_webrtc</code> (0/1) </td><td align="left"><code>enable_webrtc</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>enable_wifi_bootstrapping</code> (0/1) </td><td align="left"><code>enable_wifi_bootstrapping</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>image_loader_extension</code> (0/1) </td><td align="left"><code>enable_image_loader_extension</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>input_speech</code> (0/1) </td><td align="left"><code>enable_speech_input</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>notifications</code> (0/1) </td><td align="left"><code>enable_notifications</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>ozone_platform_dri</code> (0/1) </td><td align="left"><code>ozone_platform_dri</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>remoting</code> (0/1) </td><td align="left"><code>enable_remoting</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>safe_browsing</code> (0/1/2) </td><td align="left"><code>safe_browsing_mode</code> (0/1/2) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_allocator</code> (<code>'none'</code></td><td align="left"><code>'tcmalloc'</code>) </td><td align="left"><code>use_allocator</code> (<code>"none"</code></td><td align="left"><code>"tcmalloc"</code>) </td><td align="left">(See “Allocator” below) </td></tr><tr><td align="left"><code>ui_compositor_image_transport</code> (0/1) </td><td align="left"><code>ui_compositor_image_transport</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_ash</code> (0/1) </td><td align="left"><code>use_ash</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_athena</code> (0/1) </td><td align="left"><code>use_athena</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_aura</code> (0/1) </td><td align="left"><code>use_aura</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_brlapi</code> (0/1) </td><td align="left"><code>use_brlapi</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_cairo</code> (0/1) </td><td align="left"><code>use_cairo</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_clipboard_aurax11</code> (0/1) </td><td align="left"><code>use_aura &amp;&amp; use_x11</code> </td><td align="left"> </td></tr><tr><td align="left"><code>use_cups</code> (0/1) </td><td align="left"><code>use_cups</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_dbus</code> (0/1) </td><td align="left"><code>use_dbus</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_gconf</code> (0/1) </td><td align="left"><code>use_gconf</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_glib</code> (0/1) </td><td align="left"><code>is_linux</code> (true/false) </td><td align="left">(global) </td></tr><tr><td align="left"><code>use_gnome_keyring</code> (0/1) </td><td align="left"><code>is_desktop_linux</code> (true/false) </td><td align="left"> </td></tr><tr><td align="left"><code>use_goma</code> (0/1) </td><td align="left"><code>use_goma</code> (true/false) </td><td align="left"><code>//build/toolchain/goma.gni</code> </td></tr><tr><td align="left"><code>use_nss_certs</code> (0/1) </td><td align="left"><code>use_nss_certs</code> (true/false) </td><td align="left"><code>//build/config/crypto.gni</code> (Many of these conditions can be deleted, see the “SSL” notes on targets below.) </td></tr><tr><td align="left"><code>use_openssl</code> (0/1) </td><td align="left"><code>use_openssl</code> (true/false) </td><td align="left"><code>//build/config/crypto.gni</code> (Many of these conditions can be deleted, see the “SSL” notes on targets below.) </td></tr><tr><td align="left"><code>use_pango</code> (0/1) </td><td align="left"><code>use_pango</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_ozone</code> (0/1) </td><td align="left"><code>use_ozone</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_seccomp_bpf</code> (0/1) </td><td align="left"><code>use_seccomp_bpf</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_udev</code> (0/1) </td><td align="left"><code>use_udev</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>use_x11</code> (0/1) </td><td align="left"><code>use_x11</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>use_xi2_mt</code> (0/1) </td><td align="left"><code>use_xi2_mt</code> (true/false) </td><td align="left"><code>//build/config/ui.gni</code> </td></tr><tr><td align="left"><code>win_pdf_metafile_for_printing</code> (0/1) </td><td align="left"><code>win_pdf_metafile_for_printing</code> (true/false) </td><td align="left"><code>//build/config/features.gni</code> </td></tr><tr><td align="left"><code>win_use_allocator_shim</code> (0/1) </td><td align="left"> </td><td align="left">(See “Allocator” below) </td></tr></tbody></table><h3><a class="h" name="Common-target-conversion" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Common-target-conversion"><span></span></a>Common target conversion</h3><p>Some targets that lots of projects depend on and how the GN ones correspond to GYP ones. (This is for commonly-depended-on or weird targets only, don’t add stuff here just because you converted it.)</p><table><thead><tr><th align="left"><em>GYP</em> </th><th align="left"><em>GN</em> </th><th align="left"><em>Notes</em> (see below) </th></tr></thead><tbody><tr><td align="left"><code>base/base.gyp:base</code> </td><td align="left"><code>//base</code> </td><td align="left"> </td></tr><tr><td align="left"><code>base/base.gyp:base_i18n</code> </td><td align="left"><code>//base:i18n</code> </td><td align="left"> </td></tr><tr><td align="left"><code>base/base.gyp:run_all_unittests</code> </td><td align="left"><code>//base/test:run_all_unittests</code> </td><td align="left"> </td></tr><tr><td align="left"><code>base/base.gyp:test_support_base</code> </td><td align="left"><code>//base/test:test_support</code> </td><td align="left"> </td></tr><tr><td align="left"><code>base/third_party/dynamic_annotations/dynamic_annotations.gyp:dynamic_annotations</code> </td><td align="left"><code>//base/third_party/dynamic_annotations</code> </td><td align="left"> </td></tr><tr><td align="left"><code>build/linux/system.gyp:*</code> (except ssl) </td><td align="left"><code>//build/config/linux:*</code> </td><td align="left">Linux system targets </td></tr><tr><td align="left"><code>build/linux/system.gyp:ssl</code> </td><td align="left"><code>//crypto:platform</code> </td><td align="left">SSL </td></tr><tr><td align="left"><code>net/third_party/nss/ssl.gyp:libssl</code> </td><td align="left"><code>//crypto:platform</code> </td><td align="left">SSL </td></tr><tr><td align="left"><code>skia/skia.gyp:skia</code> </td><td align="left"><code>//skia</code> </td><td align="left"> </td></tr><tr><td align="left"><code>testing/gmock.gyp:gmock</code> </td><td align="left"><code>//testing/gmock</code> </td><td align="left">Secondary tree </td></tr><tr><td align="left"><code>testing/gtest.gyp:gtest</code> </td><td align="left"><code>//testing/gtest</code> </td><td align="left">Secondary treeo </td></tr><tr><td align="left"><code>third_party/icu/icu.gyp:icui18n</code> </td><td align="left"><code>//third_party/icu</code> </td><td align="left">Secondary tree, ICU </td></tr><tr><td align="left"><code>third_party/icu/icu.gyp:icuuc</code> </td><td align="left"><code>//third_party/icu</code> </td><td align="left">Secondary tree, ICU </td></tr><tr><td align="left"><code>url/url.gyp:url_lib</code> </td><td align="left" colspan="2"><code>//url</code> </td><td align="left" colspan="2"> </td></tr></tbody></table><p>Notes:</p><ul><li><p><em>ICU:</em> GN has separate <code>//third_party/icu:icuuc</code> and <code>//third_party/icu:icui18n</code> targets just like GYP. You can use these if you only need one of them. Most targets want both, so GN made a meta target that’s just <code>//third_party/icu</code> which you can use that redirects to both “uc” and “i18n”.</p></li><li><p><em>Linux system targets:</em> Generally the names in GN patch the GYP names for the Linux system-related stuff. However, most of them are configs instead of actual targets (in GYP they’re all targets). For example, since “x11” is just a list of libraries and include directories, and includes no sources it’s a config that just adds this configuration to your target. To use a config, do <code>configs += [
"//build/config/linux:x11" ]</code></p></li><li><p><em>Secondary tree:</em> Some projects are DEPSed in and we want it to look like a BUILD.gn file is in that directory without checking it in to the upstream repo. The directory <code>build/secondary</code> mirrors the main tree and is checked for BUILD.gn files if an expected file in the main tree wasn’t found.</p></li><li><p><em>SSL:</em> In GYP there are lots of conditions around NSS vs. OpenSSL and different platforms that determine which of the different SSL libraries is linked. In GN, there is a meta-target <code>//crypto:platform</code> that will “do the right thing” according to the current build platform and flags. Generally its safe to replace any conditional reference to a SSL library with this one.</p></li></ul><h2><a class="h" name="Visibility-and-header-file-issues" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Visibility-and-header-file-issues"><span></span></a>Visibility and header file issues</h2><p>GN is much more strict about header file checking. You may encounter errors that your target doesn’t depend on the target containing a certain header file. The most common example is including <code>base/macros.h</code> without having <code>//base</code> in your project’s dependency list. The solution is to just add the missing dependency.</p><p>The dependency tree must be a DAG. Some components might share headers between a number of internal targets that makes adding the “proper” dependencies impossible. In this case, you can separate out a <code>source_set</code> type target containing just the header(s) in question, and make the targets that use that header depend on that source set to break the cycle.</p><h2><a class="h" name="Other-stuff" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Other-stuff"><span></span></a>Other stuff</h2><h3><a class="h" name="Target-conditions" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Target-conditions"><span></span></a>Target conditions</h3><p><code>target_conditions</code> are like normal conditions but expanded in a different phase of GYP. You can generally just convert the conditions inside and not worry about the <code>conditions</code>/<code>target_conditions</code> difference.</p><h3><a class="h" name="xcode_settings" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#xcode_settings"><span></span></a>xcode_settings</h3><p>Some xcode settings are obvious:</p><pre class="code">  'xcode_settings': {'OTHER_LDFLAGS': ['-foo']},
</pre><p>Should just expand to:</p><pre class="code">  ldflags = [ "-foo" ]
</pre><p>Other flags are less obvious:</p><pre class="code">  'xcode_settings': { 'GCC_SYMBOLS_PRIVATE_EXTERN': 'NO', },
</pre><p>These all correspond to various flags that get passed to the compiler or linker. You can use your favorite search engine to see what it corresponds to, but many of them are not well documented. You can also search for the string in <a href="https://code.google.com/p/chromium/codesearch#chromium/src/tools/gyp/pylib/gyp/xcode_emulation.py">tools/gyp/pylib/gyp/xcode_emulation.py</a>. GYP uses this file to decode the Xcode settings into command line flags for the ninja build.</p><h3><a class="h" name="wexit_time-destructors" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#wexit_time-destructors"><span></span></a>wexit-time destructors</h3><p>Replace</p><pre class="code">'enable_wexit_time_destructors': 1,
</pre><p>with</p><pre class="code">configs += [ "//build/config/compiler:wexit_time_destructors" ]
</pre><h3><a class="h" name="Chromium-code" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Chromium-code"><span></span></a>Chromium code</h3><p>In GYP code is “non-Chromium” by default, and you opt into higher warning levels using:</p><pre class="code">'chromium_code': 1,
</pre><p>In GN, all code is Chromium code by default. If you’re compiling a static library that needs more lax warnings, opt out of the Chromium-code settings with:</p><pre class="code">configs -= [ "//build/config/compiler:chromium_code" ]
configs += [ "//build/config/compiler:no_chromium_code" ]
</pre><h3><a class="h" name="fvisibility" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#fvisibility"><span></span></a>-fvisibility</h3><p>All symbols in the build have “hidden” visibility by default (this means that symbols aren’t exported from shared libraries, a concept different than GN’s target visibility). If you needed to export all symbols (for a third party library) by default in GYP you would do:</p><pre class="code">'xcode_settings': [
  'GCC_SYMBOLS_PRIVATE_EXTERN': 'NO',  # no -fvisibility=hidden
],
'cflags!': [
  '-fvisibility=hidden',
],
</pre><p>In GN the equivalent is:</p><pre class="code">if (!is_win) {
  configs -= [ "//build/config/gcc:symbol_visibility_hidden" ]
}
</pre><h3><a class="h" name="Dependent-settings" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Dependent-settings"><span></span></a>Dependent settings</h3><p>In GYP you’ll see stuff like this, especially in third-party code.</p><pre class="code">'direct_dependent_settings': {
  'include_dirs': [
    '.',  # This directory.
    '../..',  # Root "src" path.
  ],
  'defines': [
    'FOO',
  ],
},
</pre><p>Note that many of the includes are trying to add the root “src” directory to the include path. This is always present in GN so you can remove these.</p><p>GYP also requires you do duplicate these settings, once for the target itself, and once for the direct/all dependent settings. In GN, public/all dependent configs also apply to the current target so you only need to specify it once.</p><p>In GN, put the settings in a config (declared above your target), and then reference that as a public config in your target:</p><pre class="code">config("foo_config") {
  include_dirs = [ "." ]
  defines = [ "FOO" ]
}

component("foo") {
  ...
  public_configs = [ ":foo_config" ]
}
</pre><p>Targets that depend on <code>foo</code> will now get <code>foo_config</code> applied.</p><p>GYP would say <code>export_dependent_settings</code> to forward <code>direct_dependent_settings</code> up the dependency chain. In GN, put the dependency in the <code>public_deps</code> section and this will happen automatically.</p><h3><a class="h" name="MSVS-disabled-warnings" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#MSVS-disabled-warnings"><span></span></a>MSVS disabled warnings</h3><p>In GYP you’ll see for third-party code:</p><pre class="code">'msvs_disabled_warnings': [ 4018, 4244, 4267, ],
</pre><p>At least half of the warnings in these blocks are already disabled globally (we added more global ones later). From the command line, do:</p><pre class="code">$ cd src/build/config
$ git grep 4018
compiler/BUILD.gn:      "/wd4018",  # Comparing signed and unsigned values.
</pre><p>tells us that warning 4018 is already disabled globally from the <code>default_warning_flags</code> variable in <code>//build/config/compiler</code>, and the same for 4244. So ignore these.</p><p>Always comment what the warning is. Use your favorite search engine and type “vc warning 4267” to look it up. You’ll end up with:</p><pre class="code">if (is_win) {
  cflags += [
    "/wd4267",  # Conversion from size_t to 'type'.
  ]
}
</pre><p>(Use <code>=</code> instead of <code>+=</code> is you haven’t already defined a <code>cflags</code> variable.)</p><h3><a class="h" name="Mac-frameworks" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Mac-frameworks"><span></span></a>Mac frameworks</h3><p>GN knows to convert <code>.framework</code> files in the <code>libs</code> list to the right thing on Mac. You don’t need to specify the directories either. So convert this:</p><pre class="code">'link_settings': {
  'libraries': [
    '$(SDKROOT)/System/Library/Frameworks/Accelerate.framework',
  ],
},
</pre><p>to this:</p><pre class="code">libs = [ "Accelerate.framework" ]
</pre><h3><a class="h" name="hard_dependency" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#hard_dependency"><span></span></a>hard_dependency</h3><p>GYP code sometimes sets</p><pre class="code">  'hard_dependency': 1,
</pre><p>to indicate that the current target must be build before its dependents. GN can deduce this internally, so you can ignore this directive.</p><h3><a class="h" name="Allocator" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Allocator"><span></span></a>Allocator</h3><p>GYP has <code>win_use_allocator_shim</code> and <code>use_allocator</code>. In GN, these are merged into <code>use_allocator</code> which is defined in <code>//build/config/allocator.gni</code>. <em>However</em> you should almost never need to use this flag. The <code>//base/allocator</code> target will change depending on the current allocator flag, so you can unconditionally depend on this target to pick up the current build defaults.</p><p>This:</p><pre class="code">  ['use_allocator!='none'', {
    'dependencies': [ '../base/allocator/allocator.gyp:allocator' ]
  }],
  ['win_use_allocator_shim==1', {
    'dependencies': [ '&lt;(allocator_target)' ],
  }],
</pre><p>Becomes:</p><pre class="code">  deps = [ "//base/allocator" ]
</pre><p>As in GYP, the allocator should only be depended on by executables (and tests). Libraries should not set the allocator.</p><h3><a class="h" name="optimize_max" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#optimize_max"><span></span></a>optimize: max</h3><p>In Gyp:</p><pre class="code">'optimize': 'max',
</pre><p>only affects Windows and will optimize for speed rather than size. To get the same behavior in GN, do:</p><pre class="code">if (!is_debug &amp;&amp; is_win) {
  configs -= [ "//build/config/compiler:optimize" ]
  configs += [ "//build/config/compiler:optimize_max" ]
}
</pre><p>The <code>is_win</code> check is needed because the <code>optimize_max</code> config also affects Posix systems. Some components might additionally specify <code>-O2</code> on Posix further optimize, in which case you can remove the <code>is_win</code> check.</p><h3><a class="h" name="Protobufs" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Protobufs"><span></span></a>Protobufs</h3><pre class="code">import("//third_party/protobuf/proto_library.gni")

proto_library("myproto") {
  sources = [ "foo.proto" ]
}
</pre><p>See the <code>third_party/protobuf/proto_library.gni</code> file for full documentation and extra flags.</p><h3><a class="h" name="Java-stuff" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Java-stuff"><span></span></a>Java stuff</h3><p>JNI generator in GYP:</p><pre class="code">{
  'target_name': 'foo_headers',
  'type': 'none',
  'sources': [ &lt;java files&gt; ]
  'variables': { 'jni_gen_package': 'foobar' }
  'includes': [ 'build/jni_generator.gypi' ]
}
</pre><p>JNI generator in GN:</p><pre class="code"># At top of file:
if (is_android) {
  import("//build/config/android/rules.gni")
}

# Later:
if (is_android) {
  generate_jni("foo_headers") {
    sources = [ &lt;java files&gt; ]
    jni_package = "foobar"
  }
}
</pre><h3><a class="h" name="Grit" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Grit"><span></span></a>Grit</h3><pre class="code">import("//tools/grit/grit_rule.gni")

grit("resources") {
  source = "my_resources.grd"
}
</pre><p>See <code>src/build/secondary/tools/grit/grit_rule.gni</code> for more documentation.</p><h3><a class="h" name="Mojo" href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/docs/cookbook.md#Mojo"><span></span></a>Mojo</h3><pre class="code">import("//mojo/public/tools/bindings/mojom.gni")

mojom("mojo_bindings") {
  sources = [
    "foo.mojom",
  ]
}
</pre></div><div class="footer-break"></div><div class="footer-line"><div class="nav-aux"><ul><li><a href="https://chromium.googlesource.com/chromium/src/+show/master/tools/gn/docs/cookbook.md">source</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+log/master/tools/gn/docs/cookbook.md">log</a></li><li><a href="https://chromium.googlesource.com/chromium/src/+blame/master/tools/gn/docs/cookbook.md">blame</a></li></ul><div class="gitiles-att">Powered by <a href="https://code.google.com/p/gitiles/">Gitiles</a></div></div></div><script async="" src="./GYP-_GN Conversion Cookbook_files/analytics.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-55762617-15', 'auto'); ga('send', 'pageview', {title: 'GYP-\x3eGN Conversion Cookbook'});</script></body></html>